import { __decorate, __metadata } from "tslib";
import { ChangeDetectionStrategy, Component, EventEmitter, HostListener, Input, Output, TemplateRef, ViewChild, } from '@angular/core';
import { Event } from '../..';
import { StyleService } from '../../services/style.service';
import { moveItemInArray } from '@angular/cdk/drag-drop';
var TableTHeadComponent = /** @class */ (function () {
    function TableTHeadComponent(styleService) {
        this.styleService = styleService;
        this.menuActive = false;
        this.openedHeaderActionTemplate = null;
        this.onSelectAllBinded = this.onSelectAll.bind(this);
        this.filter = new EventEmitter();
        this.order = new EventEmitter();
        this.selectAll = new EventEmitter();
        this.event = new EventEmitter();
    }
    TableTHeadComponent.prototype.onClick = function (targetElement) {
        if (this.additionalActionMenu && !this.additionalActionMenu.nativeElement.contains(targetElement)) {
            this.menuActive = false;
        }
    };
    TableTHeadComponent.prototype.getColumnDefinition = function (column) {
        return column.searchEnabled || typeof column.searchEnabled === 'undefined';
    };
    TableTHeadComponent.prototype.orderBy = function (column) {
        this.order.emit(column);
    };
    TableTHeadComponent.prototype.isOrderEnabled = function (column) {
        var columnOrderEnabled = column.orderEnabled === undefined ? true : !!column.orderEnabled;
        return this.config.orderEnabled && columnOrderEnabled;
    };
    TableTHeadComponent.prototype.columnDrop = function (event) {
        moveItemInArray(this.columns, event.previousIndex, event.currentIndex);
    };
    TableTHeadComponent.prototype.onSearch = function ($event) {
        this.filter.emit($event);
    };
    TableTHeadComponent.prototype.getColumnWidth = function (column) {
        if (column.width) {
            return column.width;
        }
        return this.config.fixedColumnWidth ? 100 / this.columns.length + '%' : null;
    };
    TableTHeadComponent.prototype.onSelectAll = function () {
        this.selectAll.emit();
    };
    TableTHeadComponent.prototype.onMouseDown = function (event, th) {
        if (!this.config.resizeColumn) {
            return;
        }
        this.th = th;
        this.startOffset = th.offsetWidth - event.pageX;
        this.event.emit({
            event: Event.onColumnResizeMouseDown,
            value: event,
        });
    };
    TableTHeadComponent.prototype.onMouseMove = function (event) {
        if (!this.config.resizeColumn) {
            return;
        }
        if (this.th && this.th.style) {
            this.th.style.width = this.startOffset + event.pageX + 'px';
            this.th.style.cursor = 'col-resize';
            this.th.style['user-select'] = 'none';
        }
    };
    TableTHeadComponent.prototype.onMouseUp = function (event) {
        if (!this.config.resizeColumn) {
            return;
        }
        this.event.emit({
            event: Event.onColumnResizeMouseUp,
            value: event,
        });
        this.th.style.cursor = 'default';
        this.th = undefined;
    };
    TableTHeadComponent.prototype.showHeaderActionTemplateMenu = function (column) {
        if (!column.headerActionTemplate) {
            console.error('Column [headerActionTemplate] property not defined');
        }
        if (this.openedHeaderActionTemplate === column.key) {
            this.openedHeaderActionTemplate = null;
            return;
        }
        this.openedHeaderActionTemplate = column.key;
    };
    TableTHeadComponent.prototype.showMenu = function () {
        if (!this.additionalActionsTemplate) {
            console.error('[additionalActionsTemplate] property not defined');
        }
        this.menuActive = !this.menuActive;
    };
    TableTHeadComponent.ctorParameters = function () { return [
        { type: StyleService }
    ]; };
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "config", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Array)
    ], TableTHeadComponent.prototype, "columns", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "sortKey", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "sortState", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "selectAllTemplate", void 0);
    __decorate([
        Input(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "filtersTemplate", void 0);
    __decorate([
        Input(),
        __metadata("design:type", TemplateRef)
    ], TableTHeadComponent.prototype, "additionalActionsTemplate", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "filter", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "order", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "selectAll", void 0);
    __decorate([
        Output(),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "event", void 0);
    __decorate([
        ViewChild('th'),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "th", void 0);
    __decorate([
        ViewChild('additionalActionMenu'),
        __metadata("design:type", Object)
    ], TableTHeadComponent.prototype, "additionalActionMenu", void 0);
    __decorate([
        HostListener('document:click', ['$event.target']),
        __metadata("design:type", Function),
        __metadata("design:paramtypes", [Object]),
        __metadata("design:returntype", void 0)
    ], TableTHeadComponent.prototype, "onClick", null);
    TableTHeadComponent = __decorate([
        Component({
            selector: '[table-thead]',
            template: "<tr class=\"ngx-table__header\" *ngIf=\"config.headerEnabled && !config.columnReorder\">\n  <th *ngIf=\"config.checkboxes || config.radio\" [style.width]=\"'3%'\">\n    <ng-container\n      *ngIf=\"selectAllTemplate && config.checkboxes\"\n      [ngTemplateOutlet]=\"selectAllTemplate\"\n      [ngTemplateOutletContext]=\"{ $implicit: onSelectAllBinded }\">\n    </ng-container>\n    <label class=\"ngx-form-checkbox\"\n           for=\"selectAllCheckboxes\"\n           *ngIf=\"!selectAllTemplate && config.checkboxes\">\n      <input type=\"checkbox\" id=\"selectAllCheckboxes\" (change)=\"onSelectAll()\">\n      <em class=\"ngx-form-icon\" id=\"selectAllCheckbox\"></em>\n    </label>\n  </th>\n  <ng-container *ngFor=\"let column of columns; let colIndex = index; let last = last\">\n    <th class=\"ngx-table__header-cell\"\n        [class.pinned-left]=\"column.pinned\"\n        [ngClass]=\"column.cssClass && column.cssClass.includeHeader ? column.cssClass.name : ''\"\n        [style.left]=\"styleService.pinnedWidth(column.pinned, colIndex)\"\n        #th\n        [style.width]=\"getColumnWidth(column)\"\n        (mousedown)=\"onMouseDown($event, th)\"\n        (mouseup)=\"onMouseUp($event)\"\n        (mousemove)=\"onMouseMove($event)\">\n      <div (click)=\"orderBy(column)\" style=\"display: inline\" [class.pointer]=\"isOrderEnabled(column)\">\n        <div class=\"ngx-table__header-title\">{{ column.title }}<span>&nbsp;</span>\n          <em class=\"ngx-icon ngx-icon-pin\" *ngIf=\"column.pinned\"></em>\n          <div [style.display]=\"config.orderEnabled ? 'inline' : 'none' \">\n            <em *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === 'asc'\"\n               class=\"ngx-icon ngx-icon-arrow-up\">\n            </em>\n            <em *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === 'desc'\"\n               class=\"ngx-icon ngx-icon-arrow-down\">\n            </em>\n          </div>\n        </div>\n      </div>\n      <div class=\"ngx-dropdown\"\n           *ngIf=\"!!column.headerActionTemplate\">\n        <a class=\"ngx-btn ngx-btn-link\" (click)=\"showHeaderActionTemplateMenu(column)\">\n          <span class=\"ngx-icon ngx-icon-more\"></span>\n        </a>\n        <div class=\"ngx-menu ngx-table__table-menu\"\n            *ngIf=\"column.key === openedHeaderActionTemplate\">\n          <ng-container\n            [ngTemplateOutlet]=\"column.headerActionTemplate\">\n          </ng-container>\n        </div>\n      </div>\n      <div class=\"ngx-table__column-resizer\" *ngIf=\"config.resizeColumn && !last\"></div>\n    </th>\n  </ng-container>\n  <th *ngIf=\"config.additionalActions || config.detailsTemplate || config.collapseAllRows || config.groupRows\"\n      class=\"ngx-table__header-cell-additional-actions\">\n    <div class=\"ngx-dropdown\"\n         #additionalActionMenu\n         *ngIf=\"config.additionalActions\">\n      <a class=\"ngx-btn ngx-btn-link\" (click)=\"showMenu()\">\n        <span class=\"ngx-icon ngx-icon-menu\"></span>\n      </a>\n      <ul class=\"ngx-menu ngx-table__table-menu\"\n          *ngIf=\"menuActive\">\n        <ng-container\n          *ngIf=\"additionalActionsTemplate\"\n          [ngTemplateOutlet]=\"additionalActionsTemplate\">\n        </ng-container>\n      </ul>\n    </div>\n  </th>\n</tr>\n<tr class=\"ngx-table__header ngx-table__header--draggable\"\n    *ngIf=\"config.headerEnabled && config.columnReorder\"\n    cdkDropList\n    cdkDropListOrientation=\"horizontal\"\n    (cdkDropListDropped)=\"columnDrop($event)\"\n>\n  <th [style.width]=\"'3%'\">\n    <ng-container\n      *ngIf=\"selectAllTemplate && config.checkboxes\"\n      [ngTemplateOutlet]=\"selectAllTemplate\"\n      [ngTemplateOutletContext]=\"{ $implicit: onSelectAllBinded }\">\n    </ng-container>\n    <label class=\"ngx-form-checkbox\"\n           for=\"selectAllCheckboxes\"\n           *ngIf=\"!selectAllTemplate && config.checkboxes\">\n      <input type=\"checkbox\" id=\"selectAllCheckboxesDrag\" (change)=\"onSelectAll()\">\n      <em class=\"ngx-form-icon\" id=\"selectAllCheckboxDrag\"></em>\n    </label>\n  </th>\n  <ng-container *ngFor=\"let column of columns; let colIndex = index; let last = last\">\n    <th class=\"ngx-table__header-cell ngx-table__header-cell--draggable\"\n        cdkDragLockAxis=\"x\"\n        cdkDrag\n        [class.pinned-left]=\"column.pinned\"\n        [ngClass]=\"column.cssClass && column.cssClass.includeHeader ? column.cssClass.name : ''\"\n        [style.left]=\"styleService.pinnedWidth(column.pinned, colIndex)\"\n        #th\n        [style.width]=\"getColumnWidth(column)\"\n        (mousedown)=\"onMouseDown($event, th)\"\n        (mouseup)=\"onMouseUp($event)\"\n        (mousemove)=\"onMouseMove($event)\">\n      <div (click)=\"orderBy(column)\" style=\"display: inline\"\n           cdkDragHandle\n           [class.pointer]=\"isOrderEnabled(column)\">\n        <div class=\"ngx-table__header-title\">{{ column.title }}<span>&nbsp;</span>\n          <em class=\"ngx-icon ngx-icon-pin\" *ngIf=\"column.pinned\"></em>\n          <div [style.display]=\"config.orderEnabled ? 'inline' : 'none' \">\n            <em *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === 'asc'\"\n                class=\"ngx-icon ngx-icon-arrow-up\">\n            </em>\n            <em *ngIf=\"sortKey === column.key && this.sortState.get(sortKey) === 'desc'\"\n                class=\"ngx-icon ngx-icon-arrow-down\">\n            </em>\n          </div>\n        </div>\n      </div>\n      <div class=\"ngx-dropdown\"\n           *ngIf=\"!!column.headerActionTemplate\">\n        <a class=\"ngx-btn ngx-btn-link\" (click)=\"showHeaderActionTemplateMenu(column)\">\n          <span class=\"ngx-icon ngx-icon-more\"></span>\n        </a>\n        <div class=\"ngx-menu ngx-table__table-menu\"\n             *ngIf=\"column.key === openedHeaderActionTemplate\">\n          <ng-container\n            [ngTemplateOutlet]=\"column.headerActionTemplate\">\n          </ng-container>\n        </div>\n      </div>\n      <div class=\"ngx-table__column-resizer\" *ngIf=\"config.resizeColumn && !last\"></div>\n    </th>\n  </ng-container>\n  <th *ngIf=\"config.additionalActions || config.detailsTemplate || config.collapseAllRows || config.groupRows\"\n      class=\"ngx-table__header-cell-additional-actions\">\n    <div class=\"ngx-dropdown\"\n         #additionalActionMenu\n         *ngIf=\"config.additionalActions\">\n      <a class=\"ngx-btn ngx-btn-link\" (click)=\"showMenu()\">\n        <span class=\"ngx-icon ngx-icon-menu\"></span>\n      </a>\n      <ul class=\"ngx-menu ngx-table__table-menu\"\n          *ngIf=\"menuActive\">\n        <ng-container\n          *ngIf=\"additionalActionsTemplate\"\n          [ngTemplateOutlet]=\"additionalActionsTemplate\">\n        </ng-container>\n      </ul>\n    </div>\n  </th>\n</tr>\n<tr *ngIf=\"config.searchEnabled && !filtersTemplate\"\n    class=\"ngx-table__sort-header\">\n  <th *ngIf=\"config.checkboxes || config.radio\"></th>\n  <ng-container *ngFor=\"let column of columns; let colIndex = index\">\n    <th\n      [ngClass]=\"column.cssClass && column.cssClass.includeHeader ? column.cssClass.name : ''\"\n      [class.pinned-left]=\"column.pinned\"\n      [style.left]=\"styleService.pinnedWidth(column.pinned, colIndex)\">\n      <table-header\n        *ngIf=\"getColumnDefinition(column)\"\n        (update)=\"onSearch($event)\"\n        [column]=\"column\">\n      </table-header>\n    </th>\n  </ng-container>\n  <th *ngIf=\"config.additionalActions || config.detailsTemplate\"></th>\n</tr>\n<ng-container *ngIf=\"filtersTemplate\">\n  <tr>\n    <ng-container [ngTemplateOutlet]=\"filtersTemplate\">\n    </ng-container>\n  </tr>\n</ng-container>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [StyleService],
            styles: ["\n    .cdk-drag-preview {\n      text-align: left;\n      padding-top: 9px;\n      padding-left: 4px;\n      color: #50596c;\n      border: 1px solid #e7e9ed;\n    }\n  "]
        }),
        __metadata("design:paramtypes", [StyleService])
    ], TableTHeadComponent);
    return TableTHeadComponent;
}());
export { TableTHeadComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGhlYWQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWVhc3ktdGFibGUvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy90aGVhZC90aGVhZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFDWixZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sRUFDTixXQUFXLEVBQ1gsU0FBUyxHQUNWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBbUIsS0FBSyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQy9DLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM1RCxPQUFPLEVBQWUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFpQnRFO0lBMEJFLDZCQUNrQixZQUEwQjtRQUExQixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQTFCckMsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQiwrQkFBMEIsR0FBa0IsSUFBSSxDQUFDO1FBRWpELHNCQUFpQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBU3BDLFdBQU0sR0FBRyxJQUFJLFlBQVksRUFBeUMsQ0FBQztRQUNuRSxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQVcsQ0FBQztRQUNwQyxjQUFTLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUNyQyxVQUFLLEdBQUcsSUFBSSxZQUFZLEVBQWlDLENBQUM7SUFjN0UsQ0FBQztJQVZNLHFDQUFPLEdBQWQsVUFBZSxhQUFrQjtRQUMvQixJQUFJLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxFQUFFO1lBQ2pHLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQztJ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bURBQVk7SUFDTztRQUFsQyxTQUFTLENBQUMsc0JBQXNCLENBQUM7O3FFQUFzQjtJQUV4RDtRQURDLFlBQVksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDOzs7O3NEQUtqRDtJQXhCVSxtQkFBbUI7UUFmL0IsU0FBUyxDQUFDO1lBQ1QsUUFBUSxFQUFFLGVBQWU7WUFDekIsa21QQUFxQztZQVVyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTtZQUMvQyxTQUFTLEVBQUUsQ0FBQyxZQUFZLENBQUM7cUJBVmhCLDJLQVFSO1NBR0YsQ0FBQzt5Q0E0QmdDLFlBQVk7T0EzQmpDLG1CQUFtQixDQW9IL0I7SUFBRCwwQkFBQztDQUFBLEFBcEhELElBb0hDO1NBcEhZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSG9zdExpc3RlbmVyLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbHVtbnMsIENvbmZpZywgRXZlbnQgfSBmcm9tICcuLi8uLic7XG5pbXBvcnQgeyBTdHlsZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zdHlsZS5zZXJ2aWNlJztcbmltcG9ydCB7IENka0RyYWdEcm9wLCBtb3ZlSXRlbUluQXJyYXkgfSBmcm9tICdAYW5ndWxhci9jZGsvZHJhZy1kcm9wJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnW3RhYmxlLXRoZWFkXScsXG4gIHRlbXBsYXRlVXJsOiAnLi90aGVhZC5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlczogW2BcbiAgICAuY2RrLWRyYWctcHJldmlldyB7XG4gICAgICB0ZXh0LWFsaWduOiBsZWZ0O1xuICAgICAgcGFkZGluZy10b3A6IDlweDtcbiAgICAgIHBhZGRpbmctbGVmdDogNHB4O1xuICAgICAgY29sb3I6ICM1MDU5NmM7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCAjZTdlOWVkO1xuICAgIH1cbiAgYF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBwcm92aWRlcnM6IFtTdHlsZVNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBUYWJsZVRIZWFkQ29tcG9uZW50IHtcbiAgcHVibGljIG1lbnVBY3RpdmUgPSBmYWxzZTtcbiAgcHVibGljIG9wZW5lZEhlYWRlckFjdGlvblRlbXBsYXRlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgcHVibGljIHN0YXJ0T2Zmc2V0O1xuICBwdWJsaWMgb25TZWxlY3RBbGxCaW5kZWQgPSB0aGlzLm9uU2VsZWN0QWxsLmJpbmQodGhpcyk7XG5cbiAgQElucHV0KCkgY29uZmlnOiBDb25maWc7XG4gIEBJbnB1dCgpIGNvbHVtbnM6IENvbHVtbnNbXTtcbiAgQElucHV0KCkgc29ydEtleTtcbiAgQElucHV0KCkgc29ydFN0YXRlO1xuICBASW5wdXQoKSBzZWxlY3RBbGxUZW1wbGF0ZTtcbiAgQElucHV0KCkgZmlsdGVyc1RlbXBsYXRlO1xuICBASW5wdXQoKSBhZGRpdGlvbmFsQWN0aW9uc1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjx2b2lkPjtcbiAgQE91dHB1dCgpIHJlYWRvbmx5IGZpbHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8QXJyYXk8eyBrZXk6IHN0cmluZzsgdmFsdWU6IHN0cmluZyB9Pj4oKTtcbiAgQE91dHB1dCgpIHJlYWRvbmx5IG9yZGVyID0gbmV3IEV2ZW50RW1pdHRlcjxDb2x1bW5zPigpO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgc2VsZWN0QWxsID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgcmVhZG9ubHkgZXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPHsgZXZlbnQ6IHN0cmluZywgdmFsdWU6IGFueSB9PigpO1xuICBAVmlld0NoaWxkKCd0aCcpIHByaXZhdGUgdGg7XG4gIEBWaWV3Q2hpbGQoJ2FkZGl0aW9uYWxBY3Rpb25NZW51JykgYWRkaXRpb25hbEFjdGlvbk1lbnU7XG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmNsaWNrJywgWyckZXZlbnQudGFyZ2V0J10pXG4gIHB1YmxpYyBvbkNsaWNrKHRhcmdldEVsZW1lbnQ6IGFueSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmFkZGl0aW9uYWxBY3Rpb25NZW51ICYmICF0aGlzLmFkZGl0aW9uYWxBY3Rpb25NZW51Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnModGFyZ2V0RWxlbWVudCkpIHtcbiAgICAgIHRoaXMubWVudUFjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyByZWFkb25seSBzdHlsZVNlcnZpY2U6IFN0eWxlU2VydmljZSxcbiAgKSB7XG5cbiAgfVxuXG4gIGdldENvbHVtbkRlZmluaXRpb24oY29sdW1uOiBDb2x1bW5zKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvbHVtbi5zZWFyY2hFbmFibGVkIHx8IHR5cGVvZiBjb2x1bW4uc2VhcmNoRW5hYmxlZCA9PT0gJ3VuZGVmaW5lZCc7XG4gIH1cblxuICBvcmRlckJ5KGNvbHVtbjogQ29sdW1ucyk6IHZvaWQge1xuICAgIHRoaXMub3JkZXIuZW1pdChjb2x1bW4pO1xuICB9XG5cbiAgaXNPcmRlckVuYWJsZWQoY29sdW1uOiBDb2x1bW5zKTogYm9vbGVhbiB7XG4gICAgY29uc3QgY29sdW1uT3JkZXJFbmFibGVkID0gY29sdW1uLm9yZGVyRW5hYmxlZCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6ICEhY29sdW1uLm9yZGVyRW5hYmxlZDtcbiAgICByZXR1cm4gdGhpcy5jb25maWcub3JkZXJFbmFibGVkICYmIGNvbHVtbk9yZGVyRW5hYmxlZDtcbiAgfVxuXG4gIGNvbHVtbkRyb3AoZXZlbnQ6IENka0RyYWdEcm9wPHN0cmluZ1tdPik6IHZvaWQge1xuICAgIG1vdmVJdGVtSW5BcnJheSh0aGlzLmNvbHVtbnMsIGV2ZW50LnByZXZpb3VzSW5kZXgsIGV2ZW50LmN1cnJlbnRJbmRleCk7XG4gIH1cblxuICBvblNlYXJjaCgkZXZlbnQ6IEFycmF5PHsga2V5OiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfT4pOiB2b2lkIHtcbiAgICB0aGlzLmZpbHRlci5lbWl0KCRldmVudCk7XG4gIH1cblxuICBnZXRDb2x1bW5XaWR0aChjb2x1bW46IGFueSk6IHN0cmluZyB8IG51bGwge1xuICAgIGlmIChjb2x1bW4ud2lkdGgpIHtcbiAgICAgIHJldHVybiBjb2x1bW4ud2lkdGg7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbmZpZy5maXhlZENvbHVtbldpZHRoID8gMTAwIC8gdGhpcy5jb2x1bW5zLmxlbmd0aCArICclJyA6IG51bGw7XG4gIH1cblxuICBvblNlbGVjdEFsbCgpOiB2b2lkIHtcbiAgICB0aGlzLnNlbGVjdEFsbC5lbWl0KCk7XG4gIH1cblxuICBvbk1vdXNlRG93bihldmVudDogTW91c2VFdmVudCwgdGg6IEhUTUxUYWJsZUhlYWRlckNlbGxFbGVtZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5yZXNpemVDb2x1bW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy50aCA9IHRoO1xuICAgIHRoaXMuc3RhcnRPZmZzZXQgPSB0aC5vZmZzZXRXaWR0aCAtIGV2ZW50LnBhZ2VYO1xuICAgIHRoaXMuZXZlbnQuZW1pdCh7XG4gICAgICBldmVudDogRXZlbnQub25Db2x1bW5SZXNpemVNb3VzZURvd24sXG4gICAgICB2YWx1ZTogZXZlbnQsXG4gICAgfSk7XG4gIH1cblxuICBvbk1vdXNlTW92ZShldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcucmVzaXplQ29sdW1uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0aGlzLnRoICYmIHRoaXMudGguc3R5bGUpIHtcbiAgICAgIHRoaXMudGguc3R5bGUud2lkdGggPSB0aGlzLnN0YXJ0T2Zmc2V0ICsgZXZlbnQucGFnZVggKyAncHgnO1xuICAgICAgdGhpcy50aC5zdHlsZS5jdXJzb3IgPSAnY29sLXJlc2l6ZSc7XG4gICAgICB0aGlzLnRoLnN0eWxlWyd1c2VyLXNlbGVjdCddID0gJ25vbmUnO1xuICAgIH1cbiAgfVxuXG4gIG9uTW91c2VVcChldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcucmVzaXplQ29sdW1uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZXZlbnQuZW1pdCh7XG4gICAgICBldmVudDogRXZlbnQub25Db2x1bW5SZXNpemVNb3VzZVVwLFxuICAgICAgdmFsdWU6IGV2ZW50LFxuICAgIH0pO1xuICAgIHRoaXMudGguc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnO1xuICAgIHRoaXMudGggPSB1bmRlZmluZWQ7XG4gIH1cblxuICBzaG93SGVhZGVyQWN0aW9uVGVtcGxhdGVNZW51KGNvbHVtbjogQ29sdW1ucyk6IHZvaWQge1xuICAgIGlmICghY29sdW1uLmhlYWRlckFjdGlvblRlbXBsYXRlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdDb2x1bW4gW2hlYWRlckFjdGlvblRlbXBsYXRlXSBwcm9wZXJ0eSBub3QgZGVmaW5lZCcpO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcGVuZWRIZWFkZXJBY3Rpb25UZW1wbGF0ZSA9PT0gY29sdW1uLmtleSkge1xuICAgICAgdGhpcy5vcGVuZWRIZWFkZXJBY3Rpb25UZW1wbGF0ZSA9IG51bGw7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMub3BlbmVkSGVhZGVyQWN0aW9uVGVtcGxhdGUgPSBjb2x1bW4ua2V5O1xuICB9XG5cbiAgc2hvd01lbnUoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmFkZGl0aW9uYWxBY3Rpb25zVGVtcGxhdGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1thZGRpdGlvbmFsQWN0aW9uc1RlbXBsYXRlXSBwcm9wZXJ0eSBub3QgZGVmaW5lZCcpO1xuICAgIH1cbiAgICB0aGlzLm1lbnVBY3RpdmUgPSAhdGhpcy5tZW51QWN0aXZlO1xuICB9XG59XG4iXX0=